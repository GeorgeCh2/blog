# [视频转码 Nvidia GPU 硬件加速研究](https://github.com/GeorgeCh2/blog/issues/12)

## 背景
高清视频与日俱增，目前我们使用的较多的还是 h264 软件转码，视频质量不是特别理想，而且视频体积相较于 h265 编码格式的视频大。
H265 视频质量较高的同时体积也没有增加，在此前提下带来的是编码复杂度的大幅提升，仍旧使用软件（CPU）进行编码就不太现实了，耗时达到了 原视频 duration 的2倍，肯定无法接受。
所以，如果想要使用 H265 编码，就需要用上硬件加速了。
## 编译 FFmpeg
### 编译并安装依赖库
#### nv-codec-headers
``` shell
git clone https://github.com/FFmpeg/nv-codec-headers.git
cd nv-codec-headers & make install
```
这里是编译安装到了 usr/lib 目录下，也可自己指定安装目录（后面编译 ffmpeg 会指定依赖库目录）
注：需要查看当前 GPU 使用的驱动版本，如果不想升级本地已安装的驱动，需要切换 nv-codec-headers 对应的版本
通过 nvidia-smi 查看已安装的驱动：
![image](https://user-images.githubusercontent.com/22410736/158746057-510ef017-fe98-4a73-bafb-422b09e438bb.png)
CUD-Toolkit 驱动对应版本：


CUDA Toolkit | Linux x86_64 Driver Version
-- | --

CUDA 11.4 Update 1 | >=470.57.02
CUDA 11.4.0 GA | >=470.42.01
CUDA 11.3.1 Update 1 | >=465.19.01
CUDA 11.3.0 GA | >=465.19.01
CUDA 11.2.2 Update 2 | >=460.32.03
CUDA 11.2.1 Update 1 | >=460.32.03
CUDA 11.2.0 GA | >=460.27.03
CUDA 11.1.1 Update 1 | >=455.32
CUDA 11.1 GA | >=455.23
CUDA 11.0.3 Update 1 | >= 450.51.06
CUDA 11.0.2 GA | >= 450.51.05
CUDA 11.0.1 RC | >= 450.36.06
CUDA 10.2.89 | >= 440.33
CUDA 10.1 (10.1.105 general release, and updates) | >= 418.39
CUDA 10.0.130 | >= 410.48
CUDA 9.2 (9.2.148 Update 1) | >= 396.37
CUDA 9.2 (9.2.88) | >= 396.26
CUDA 9.1 (9.1.85) | >= 390.46
CUDA 9.0 (9.0.76) | >= 384.81
CUDA 8.0 (8.0.61 GA2) | >= 375.26
CUDA 8.0 (8.0.44) | >= 367.48
CUDA 7.5 (7.5.16) | >= 352.31
CUDA 7.0 (7.0.28) | >= 346.46

